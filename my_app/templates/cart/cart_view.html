{% extends "catalog/base.html" %}

{% block content %}
<h1>Ваша корзина</h1>
<ul>
    {% set total_price = 0 %}  {# Используем set вместо with для инициализации переменной #}
    {% for item in items %}
        <li>
            {{ item.product.name }} -
            <form action="{{ url_for('cart.update_cart_item', cart_id=cart.id, item_id=item.id) }}" method="post" style="display:inline;">
                <input type="number" name="quantity" value="{{ item.quantity }}" min="1">
                <button type="submit">Обновить</button>
            </form>
            - {{ item.product.price }}₽ x {{ item.quantity }} шт. = {{ item.product.price * item.quantity }}₽  {# Используем обычное умножение #}
            {% set item_total = item.product.price * item.quantity %}  {# Используем set для вычисления item_total #}
            {% set total_price = total_price + item_total %}  {# Обновляем total_price #}
            <a href="{{ url_for('cart.remove_cart_item', cart_id=cart.id, item_id=item.id) }}">Удалить</a>
        </li>
    {% endfor %}
</ul>
<h2>Итого: {{ total_price }}₽</h2>
{% endblock %}